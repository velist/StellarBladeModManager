# 剑星MOD管理器（StellarBlade MOD Manager）

一个基于 PySide6 的剑星MOD桌面管理器，支持MOD导入、分类、启用/禁用、预览图、国际化等功能。

## 主要特性
- MOD一键导入、启用/禁用、重命名、删除
- 分类管理（支持拖动排序、层级调整）
- 预览图展示与修改
- 中英文切换
- 目录树双击展开/收起
- 现代美观UI，深色主题

## 安装说明

### 方法一：直接下载
1. 从 https://pan.xunlei.com/s/VOSV1m7gYTgOshRDP731Xap4A1?pwd=3hep# 页面下载最新版本，含旧版文件
2. 解压后运行 `jianxing-mod-manager.exe`

### 方法二：从源码构建
1. 克隆仓库：
```bash
git clone https://github.com/yourusername/jianxing-mod-manager.git
cd jianxing-mod-manager
```

2. 安装依赖：
```bash
pip install -r requirements.txt
```

3. 运行程序：
```bash
python main.py
```

4. 构建可执行文件：
```bash
python build.py
```

## 依赖要求
- Python 3.8+
- PySide6
- 其他依赖见 requirements.txt

## 使用说明

### 基础操作
1. 首次启动
   - 选择MOD文件夹和备份文件夹，两者缺一不可
   - 推荐MOD文件夹路径：游戏安装目录\SB\Content\Paks\~mods
   - 备份文件夹可以选择任意位置，建议选择空文件夹

2. 导入MOD
   - 点击右侧"导入MOD"按钮
   - 选择MOD压缩包文件（支持zip、rar、7z格式）
   - 支持批量选择多个MOD文件同时导入
   - 支持嵌套压缩包（压缩包内包含其他压缩包）

3. 管理MOD
   - 单击MOD可查看详细信息
   - 点击"启用/禁用MOD"按钮可切换MOD状态
   - 右键MOD可显示更多操作选项

### 高级功能
1. 分类管理
   - 左侧分类树支持右键菜单操作
   - 可新建、重命名、删除分类
   - 支持拖动排序和层级调整
   - 双击分类可展开/收起子分类

2. MOD编辑模式
   - 点击工具栏"编辑"按钮进入编辑模式
   - 支持多选MOD（按住Ctrl键点选或Shift键范围选择）
   - 可批量启用/禁用/删除/移动分类
   - 拖放功能支持在不同分类间移动MOD

3. 预览图管理
   - 点击MOD信息卡片中的预览图区域可更换预览图
   - 支持jpg、png、webp等常见图片格式
   - 推荐使用1:1或16:9比例的图片

4. 右键菜单
   - MOD列表支持右键菜单，提供快捷操作
   - 可快速启用/禁用、重命名、删除、移动分类
   - 支持复制MOD名称和文件路径

5. 收藏工具箱
   - 点击主界面右下角"收藏工具箱"按钮
   - 可访问在线MOD收藏和管理工具
   - 提供MOD评分、收藏和分享功能

### 常见问题
1. MOD无法导入
   - 检查压缩包格式是否支持
   - 确认压缩包内包含pak、utoc或ucas文件
   - 尝试解压后手动复制到MOD文件夹

2. MOD导入后无效果
   - 确认MOD已启用（显示为绿色状态）
   - 检查游戏是否需要重启
   - 验证MOD文件结构是否正确

3. 备份恢复问题
   - 程序会自动备份原始游戏文件
   - 禁用MOD时会从备份恢复原始文件
   - 如遇问题，可尝试验证游戏完整性

4. 多层嵌套MOD问题
   - 程序支持最多10层嵌套的压缩包
   - 每个包含MOD文件的嵌套压缩包会被视为独立MOD
   - 可单独启用/禁用任意嵌套MOD

### 快捷键
- Ctrl+F：搜索MOD
- Ctrl+E：进入/退出编辑模式
- Delete：删除选中的MOD
- F1：显示帮助
- F5：刷新MOD列表

## RAR解压方案

本项目采用多重解压机制，确保RAR文件能够被正确处理：

1. 首先尝试使用WinRAR命令行工具解压
2. 如果失败，尝试使用7z命令行工具解压
3. 如果仍然失败，尝试使用Python的rarfile库解压
4. 如果所有方法都失败，则将RAR文件复制到目标文件夹

特性：
- 自动检测并递归解压嵌套的压缩包
- 智能识别MOD文件（pak/ucas/utoc组合）
- 支持子文件夹结构的MOD
- 备份和还原机制确保MOD完整性

### 嵌套压缩包处理

程序能够处理嵌套的压缩包（压缩包中包含其他压缩包），具有以下特性：

1. 递归解压嵌套压缩包，最多支持10层嵌套
2. 使用MOD文件名作为文件夹名称，而不是压缩包名称
3. 为每个包含MOD文件（pak/ucas/utoc）的嵌套压缩包创建独立的MOD
4. 跟踪嵌套MOD与父压缩包的关系，支持独立启用/禁用
5. 备份和还原机制确保嵌套MOD完整性

### 错误处理与回退机制
- 每个解压方法失败时有明确的错误日志
- 解压失败时有备选方案（复制原始文件）
- 临时目录的创建和清理

此方案确保了RAR文件的可靠解压和MOD的正确导入，解决了路径处理和文件结构问题。

## 开发说明
- 使用 PySide6 构建UI
- 使用 PyInstaller 打包
- 支持 Windows 系统

## 交流群
QQ群：788566495

## 贡献
欢迎提交 Issue 和 Pull Request！

## License
MIT License

## 最新更新 (v1.55)

### 功能增强
1. 添加了"收藏工具箱"按钮，链接到 https://codepen.io/aigame/full/MYwXoGq
   - 按钮样式与"启动游戏"按钮匹配，字体略小

2. 增强MOD列表界面
   - 添加右键上下文菜单，方便MOD管理
   - 实现编辑模式，支持多选功能
   - 新增拖放功能，可在不同分类间移动MOD

3. 新增图标
   - icon_check.svg
   - 移动.svg (移动图标)
   - 关闭-关闭.svg (关闭图标)
   - 开启-开启.svg (开启图标)

### 问题修复
1. 修复了enable_mod函数中restore_mod函数缺少mod_info参数的问题
2. 解决了RAR文件提取问题
   - 现在可以正确处理包含pak、utoc和ucas文件的RAR归档
   - 修复了嵌套RAR文件的提取问题，支持多层嵌套的MOD包
   - 确保正确创建文件夹结构，使MOD能够正常激活

### 其他改进
1. 完善了备份和恢复功能
   - 当前版本已备份至"1.55版本"文件夹
   - 验证了备份和恢复功能的可靠性

## 使用说明
[待添加]
